<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIREcalc</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0/dist/chartjs-plugin-annotation.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css?v=5">
</head>
<body>
    <a href="#accumulation-tab" class="skip-to-content">Skip to content</a>
    <header class="app-header" role="banner">
        <div class="header-content">
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
                    <path d="M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 01-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.323.152-.691.546-1.004zM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 01-.921.42z" />
                    <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 6a.75.75 0 00-1.5 0v.816a3.836 3.836 0 00-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 01-.921-.421l-.879-.66a.75.75 0 00-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 001.5 0v-.81a4.124 4.124 0 001.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 00-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 00.933-1.175l-.415-.33a3.836 3.836 0 00-1.719-.755V6z" clip-rule="evenodd" />
                </svg>
                <h1>FIREcalc</h1>
            </div>
            <nav class="header-nav" role="tablist" aria-label="Calculator tabs">
                <a href="#" data-tab="accumulation-tab" class="header-nav-link active" role="tab" aria-selected="true" aria-controls="accumulation-tab" tabindex="0">
                    <span class="nav-icon" aria-hidden="true">üí∞</span> <span class="nav-text">Savings</span>
                </a>
                <a href="#" data-tab="retirement-tab" class="header-nav-link" role="tab" aria-selected="false" aria-controls="retirement-tab" tabindex="0">
                    <span class="nav-icon" aria-hidden="true">üèñÔ∏è</span> <span class="nav-text">Retirement</span>
                </a>
            </nav>
        </div>
    </header>
    
    <!-- Accumulation Tab Content -->
    <main>
    <div id="accumulation-tab" class="tab-content" role="tabpanel" aria-labelledby="accumulation-tab">
        <div class="input-section">
            <h2 class="calculator-title">Savings Simulation</h2>
            <p class="calculator-intro">
                Plan your wealth-building journey by projecting how your savings will grow over time. This simulator helps you visualize the path to your financial goals based on your current situation and investment strategy.
            </p>
            
            <h2>Your Current Situation</h2>
            
            <div class="input-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                    <label for="currentAge">Current Age
                        <span class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">Your current age in years. This is the starting point for the simulation.</span>
                        </span>
                    </label>
                    <input type="number" id="currentAge" value="30" min="18" max="90" maxlength="2">
                </div>
                
                <div>
                    <label for="currentSavings">Current Savings ($)
                        <span class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">The total amount you have currently saved or invested for this goal.</span>
                        </span>
                    </label>
                    <input type="text" id="currentSavings" value="50000" placeholder="e.g., 50000">
                </div>
            </div>
            
            <div class="input-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                    <label for="income">Annual Income After Taxes ($)
                        <span class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">Your total yearly income after all taxes have been deducted.</span>
                        </span>
                    </label>
                    <input type="text" id="income" value="90000" placeholder="e.g., 90000">
                </div>

                <div>
                    <label for="incomeGrowth">Real Income Growth Above Inflation (%)
                        <span class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">The expected average annual percentage increase in your income ABOVE inflation. For example, 2% means your income grows 2% faster than inflation each year. Total nominal growth = this rate + inflation.</span>
                        </span>
                    </label>
                    <input type="number" id="incomeGrowth" value="2" min="0" max="10" step="0.1">
                </div>
            </div>
            
            <div>
                <label for="expenses">Annual Expenses ($)
                    <span class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Your total estimated yearly living expenses. These expenses will be adjusted for inflation each year in the simulation, based on historical inflation data.</span>
                    </span>
                </label>
                <input type="text" id="expenses" value="70000" placeholder="e.g., 70000">
            </div>
            
            <h2>Your Goal</h2>
            <div>
                <label for="targetAmount">Retirement Goal ($)
                    <span class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">The total amount of savings you are aiming to accumulate for this financial goal.</span>
                    </span>
                </label>
                <input type="text" id="targetAmount" value="1000000" placeholder="e.g., 1000000" title="Total savings target needed to fund your retirement">
            </div>
            
            <h2>Investment Strategy</h2>
            <div>
                <label for="stockAllocation">Stock Allocation: <span id="stockAllocationValue">70</span>%
                    <span class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">The percentage of your investment portfolio allocated to stocks. The remainder is assumed to be in lower-risk assets like bonds/cash (simulated with a 3% annual return). Stock returns are simulated based on historical S&amp;P 500 data.</span>
                    </span>
                </label>
                <input type="range" id="stockAllocation" min="0" max="100" value="70" 
                       oninput="document.getElementById('stockAllocationValue').textContent = this.value">
            </div>
            
            <div>
                <label for="savingsSimulationCount">Number of Simulations
                    <span class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">More simulations provide more accurate results but take longer to process.</span>
                    </span>
                </label>
                <select id="savingsSimulationCount">
                    <option value="500">500 (Faster)</option>
                    <option value="1000" selected>1,000 (Standard)</option>
                    <option value="2000">2,000 (More Accurate)</option>
                    <option value="5000">5,000 (Comprehensive)</option>
                </select>
            </div>
            
            <div class="simulation-button-wrapper">
                <button id="runSimulation" class="simulation-button" onclick="runAccumulationSimulation()">
                    Run Savings Simulation
                </button>
            </div>
        </div>

        <div id="results" class="results-container" style="display: none; flex-direction: column;">
            <div class="section-header">
                <h2>Simulation Results</h2>
            </div>
            
            <div class="result-card primary-card">
                <div class="result-highlight" id="yearsToGoal">--</div>
                <div class="result-description">Median years to reach your target.</div>
            </div>
            
            <!-- Add AI Analysis button after the primary result card -->
            <div class="ai-analysis-container">
                <button id="aiAnalysisBtn" class="ai-analysis-button">
                    <svg width="24px" height="24px" viewBox="0 0 24 24" role="img" xmlns="http://www.w3.org/2000/svg" style="margin-right: 8px;"><title>OpenAI icon</title><path d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z" fill="currentColor"/></svg>
                    AI Analysis
                </button>
            </div>
            
            <!-- Insert Range of Outcomes chart here, right after the primary results card -->
            <div class="result-card">
                <h3>Range of Outcomes
                    <span class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Shows the distribution of how many years it might take to reach your goal based on all simulations.</span>
                    </span>
                </h3>
                <div class="chart-label">Years to Reach Goal</div>
                <div class="chart-container">
                    <canvas id="yearsDistributionChart"></canvas>
                </div>
            </div>
            
            <div class="result-card">
                <h3>Median Portfolio Growth Sources
                    <span class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Shows how your savings grow in the median simulation, breaking down contributions versus investment returns over time.</span>
                    </span>
                </h3>
                <div class="chart-label">Growth Components</div>
                <div class="chart-container">
                    <canvas id="growthSourcesChart"></canvas>
                </div>
            </div>
            
            <div class="result-card">
                <h3>Key Milestones
                    <span class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Shows when you're expected to reach important savings thresholds based on the median simulation.</span>
                    </span>
                </h3>
                <div class="milestones-grid">
                    <div class="milestone">
                        <div class="milestone-percent">25%</div>
                        <div class="milestone-amount" id="milestone25Amount">$0</div>
                        <div class="milestone-age" id="milestone25">--</div>
                    </div>
                    <div class="milestone">
                        <div class="milestone-percent">50%</div>
                        <div class="milestone-amount" id="milestone50Amount">$0</div>
                        <div class="milestone-age" id="milestone50">--</div>
                    </div>
                    <div class="milestone">
                        <div class="milestone-percent">75%</div>
                        <div class="milestone-amount" id="milestone75Amount">$0</div>
                        <div class="milestone-age" id="milestone75">--</div>
                    </div>
                    <div class="milestone">
                        <div class="milestone-percent">100%</div>
                        <div class="milestone-amount" id="milestone100Amount">$0</div>
                        <div class="milestone-age" id="milestone100">--</div>
                    </div>
                </div>
            </div>
            <div class="result-card">
                <h3>Simulation Details
                    <span class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Explore individual simulation results and market scenarios.</span>
                    </span>
                </h3>
                <div class="simulation-table-container">
                    <table class="simulation-table">
                        <thead>
                            <tr>
                                <th data-sort="simNumber">Sim #</th>
                                <th data-sort="yearsToGoal">Years to Goal</th>
                                <th data-sort="finalBalance">Final Balance</th>
                                <th data-sort="avgReturn">Avg. Return</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="simulationTableBody">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- Retirement Tab Content -->
    <div id="retirement-tab" class="tab-content" role="tabpanel" aria-labelledby="retirement-tab">
        <div class="input-section">
            <h2 class="calculator-title">Retirement Simulation</h2>
            <p class="calculator-intro">
                Analyze how long your retirement savings might last under various market conditions. This simulator helps you determine a sustainable withdrawal strategy and evaluate the probability of your money lasting throughout retirement.
            </p>
            
            <h2>Retirement Planning</h2>
            <div class="input-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                    <label for="retirementAge">Retirement Age
                        <span class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">The age at which you plan to retire and start withdrawing from your savings.</span>
                        </span>
                    </label>
                    <input type="number" id="retirementAge" value="65" min="40" max="90">
                </div>
                
                <div>
                    <label for="retirementLifeExpectancy">Length of Retirement
                        <span class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">How long to run the simulation (in years after retirement).</span>
                        </span>
                    </label>
                    <input type="number" id="retirementLifeExpectancy" value="30" min="5" max="50">
                </div>
            </div>

            <div class="input-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                    <label for="retirementSavings">Expected Retirement Savings ($)
                        <span class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">The total amount of savings you anticipate having at the start of your retirement.</span>
                        </span>
                    </label>
                    <input type="text" id="retirementSavings" value="1000000" placeholder="e.g., 1000000">
                </div>
                
                <div>
                    <label for="retirementStockAllocation">Stock Allocation: <span id="retirementStockAllocationValue">60</span>%
                        <span class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">The percentage of your investment portfolio allocated to stocks during retirement. The remainder is assumed to be in lower-risk assets like bonds/cash (simulated with a 3% annual return). Stock returns are simulated based on historical S&amp;P 500 data.</span>
                        </span>
                    </label>
                    <input type="range" id="retirementStockAllocation" min="0" max="100" value="60" 
                           oninput="document.getElementById('retirementStockAllocationValue').textContent = this.value">
                </div>
            </div>
            
            <div class="input-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                    <label for="annualWithdrawal">Annual Withdrawal ($)
                        <span class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">The amount of money you plan to withdraw from your savings each year during retirement (after taxes).</span>
                        </span>
                    </label>
                    <input type="text" id="annualWithdrawal" value="40000" placeholder="e.g., 40000">
                </div>
                
                <div>
                    <label for="withdrawalAdjustment">Adjust Withdrawals for Inflation
                        <span class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">If checked, your annual withdrawals will increase each year to maintain purchasing power as prices increase.</span>
                        </span>
                    </label>
                    <input type="checkbox" id="withdrawalAdjustment" checked>
                </div>
            </div>
            
            <!-- Tax Strategy Section -->
            <div class="tax-strategy-section">
                <div class="tax-strategy-header" id="taxStrategyHeader">
                    <h2 style="margin:0; cursor:pointer;">
                        <span id="taxStrategyToggle">‚ñ∂</span> Tax Strategy
                        <span class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">Choose between a simple flat tax rate or detailed bracket-based tax modeling with account type awareness.</span>
                        </span>
                    </h2>
                </div>
                <div id="taxStrategyBody" style="display:none; margin-top: 16px;">
                    <div class="tax-mode-selector">
                        <label class="tax-mode-option">
                            <input type="radio" name="taxMode" value="simple" checked>
                            <span class="tax-mode-label">Simple (flat rate)</span>
                        </label>
                        <label class="tax-mode-option">
                            <input type="radio" name="taxMode" value="detailed">
                            <span class="tax-mode-label">Detailed (bracket-based)</span>
                        </label>
                    </div>

                    <!-- Simple Mode -->
                    <div id="taxSimpleSection">
                        <div style="margin-top: 12px;">
                            <label for="taxRate">Effective Tax Rate (%)
                                <span class="tooltip-container">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">The percentage of withdrawals that will go to taxes. Enter your expected effective tax rate in retirement.</span>
                                </span>
                            </label>
                            <input type="number" id="taxRate" value="15" min="0" max="50" step="1">
                        </div>
                    </div>

                    <!-- Detailed Mode -->
                    <div id="taxDetailedSection" style="display:none;">
                        <div class="input-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-top: 12px;">
                            <div>
                                <label for="taxFilingStatus">Filing Status</label>
                                <select id="taxFilingStatus">
                                    <option value="mfj" selected>Married Filing Jointly</option>
                                    <option value="single">Single</option>
                                </select>
                            </div>
                            <div>
                                <label for="taxStateRate">State Tax Rate (%)
                                    <span class="tooltip-container">
                                        <span class="tooltip-icon">?</span>
                                        <span class="tooltip-text">Flat state income tax rate. Set to 0 for states with no income tax.</span>
                                    </span>
                                </label>
                                <input type="number" id="taxStateRate" value="0" min="0" max="15" step="0.1">
                            </div>
                        </div>

                        <div style="margin-top: 16px;">
                            <label>Retirement Account Mix
                                <span class="tooltip-container">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">How your portfolio is split across account types. Pre-tax withdrawals are taxed as ordinary income, Roth is tax-free, and taxable brokerage gets capital gains treatment.</span>
                                </span>
                            </label>
                            <div id="accountMixBar" class="account-mix-bar">
                                <div class="mix-pretax" style="width:60%"></div>
                                <div class="mix-roth" style="width:20%"></div>
                                <div class="mix-taxable" style="width:20%"></div>
                            </div>
                            <div class="account-mix-legend">
                                <span class="mix-legend-item"><span class="mix-dot mix-dot-pretax"></span>Pre-tax</span>
                                <span class="mix-legend-item"><span class="mix-dot mix-dot-roth"></span>Roth</span>
                                <span class="mix-legend-item"><span class="mix-dot mix-dot-taxable"></span>Taxable</span>
                            </div>
                            <div class="input-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 8px;">
                                <div>
                                    <label for="taxPreTaxPct">Pre-tax (%)</label>
                                    <input type="number" id="taxPreTaxPct" value="60" min="0" max="100" step="1">
                                </div>
                                <div>
                                    <label for="taxRothPct">Roth (%)</label>
                                    <input type="number" id="taxRothPct" value="20" min="0" max="100" step="1">
                                </div>
                                <div>
                                    <label for="taxTaxablePct">Taxable (%)</label>
                                    <input type="number" id="taxTaxablePct" value="20" min="0" max="100" step="1">
                                </div>
                            </div>
                            <div id="accountMixWarning" class="tax-mix-warning" style="display:none;">‚ö† Account mix must total 100%</div>
                        </div>

                        <div style="margin-top: 12px;">
                            <label>
                                <input type="checkbox" id="taxOptimizeOrder" checked>
                                Optimize withdrawal order
                                <span class="tooltip-container">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Draw from taxable brokerage first (capital gains rates), then pre-tax (ordinary income), then Roth (tax-free) last.</span>
                                </span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 16px;">
                <label for="simulationCount">Number of Simulations
                    <span class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">More simulations provide more accurate results but take longer to process.</span>
                    </span>
                </label>
                <select id="simulationCount">
                    <option value="500">500 (Faster)</option>
                    <option value="1000" selected>1,000 (Standard)</option>
                    <option value="2000">2,000 (More Accurate)</option>
                    <option value="5000">5,000 (Comprehensive)</option>
                </select>
            </div>
            
            <!-- Income Sources (collapsible) -->
            <div class="collapsible-section">
                <button type="button" class="collapsible-toggle" id="incomeSourcesToggle" aria-expanded="false" aria-controls="incomeSourcesContent">
                    <span class="collapsible-chevron">‚ñ∂</span> Income Sources
                </button>
                <div class="collapsible-content" id="incomeSourcesContent" style="display: none;">
                    <!-- Social Security -->
                    <div class="income-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeSS" checked>
                            Include Social Security
                        </label>
                        <div class="income-subfields" id="ssFields">
                            <div class="input-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                <div>
                                    <label for="ssMonthlyBenefit">Estimated Monthly Benefit ($)
                                        <span class="tooltip-container">
                                            <span class="tooltip-icon">?</span>
                                            <span class="tooltip-text">Your estimated monthly Social Security benefit at full retirement age (67). Check ssa.gov for your estimate.</span>
                                        </span>
                                    </label>
                                    <input type="text" id="ssMonthlyBenefit" value="2000" placeholder="e.g., 2000">
                                </div>
                                <div>
                                    <label for="ssClaimingAge">Claiming Age
                                        <span class="tooltip-container">
                                            <span class="tooltip-icon">?</span>
                                            <span class="tooltip-text">Age 67 = 100% of benefit. Earlier = reduced (62 = 70%). Later = increased (70 = 124%).</span>
                                        </span>
                                    </label>
                                    <select id="ssClaimingAge">
                                        <option value="62">62</option>
                                        <option value="63">63</option>
                                        <option value="64">64</option>
                                        <option value="65">65</option>
                                        <option value="66">66</option>
                                        <option value="67" selected>67</option>
                                        <option value="68">68</option>
                                        <option value="69">69</option>
                                        <option value="70">70</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Spouse's Social Security -->
                    <div class="income-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeSpouseSS">
                            Include Spouse's Social Security
                        </label>
                        <div class="income-subfields" id="spouseSSFields" style="display: none;">
                            <div class="input-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                <div>
                                    <label for="spouseSSMonthlyBenefit">Spouse's Monthly Benefit ($)</label>
                                    <input type="text" id="spouseSSMonthlyBenefit" value="1500" placeholder="e.g., 1500">
                                </div>
                                <div>
                                    <label for="spouseSSClaimingAge">Spouse's Claiming Age</label>
                                    <select id="spouseSSClaimingAge">
                                        <option value="62">62</option>
                                        <option value="63">63</option>
                                        <option value="64">64</option>
                                        <option value="65">65</option>
                                        <option value="66">66</option>
                                        <option value="67" selected>67</option>
                                        <option value="68">68</option>
                                        <option value="69">69</option>
                                        <option value="70">70</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Other Income -->
                    <div class="income-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeOtherIncome">
                            Include Other Income
                        </label>
                        <div class="income-subfields" id="otherIncomeFields" style="display: none;">
                            <div class="input-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                <div>
                                    <label for="monthlyPension">Monthly Pension/Annuity ($)
                                        <span class="tooltip-container">
                                            <span class="tooltip-icon">?</span>
                                            <span class="tooltip-text">Fixed pension or annuity payment. Not adjusted for inflation.</span>
                                        </span>
                                    </label>
                                    <input type="text" id="monthlyPension" value="0" placeholder="e.g., 1000">
                                </div>
                                <div>
                                    <label for="pensionStartAge">Pension Start Age</label>
                                    <input type="number" id="pensionStartAge" value="65" min="40" max="90">
                                </div>
                            </div>
                            <div class="input-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 12px;">
                                <div>
                                    <label for="monthlyOtherIncome">Monthly Rental/Side Income ($)
                                        <span class="tooltip-container">
                                            <span class="tooltip-icon">?</span>
                                            <span class="tooltip-text">Additional monthly income from rental properties, part-time work, etc.</span>
                                        </span>
                                    </label>
                                    <input type="text" id="monthlyOtherIncome" value="0" placeholder="e.g., 500">
                                </div>
                                <div>
                                    <label for="otherIncomeDuration">Income Duration (years, 0 = lifetime)
                                        <span class="tooltip-container">
                                            <span class="tooltip-icon">?</span>
                                            <span class="tooltip-text">How many years this income lasts. 0 means it continues for your entire retirement.</span>
                                        </span>
                                    </label>
                                    <input type="number" id="otherIncomeDuration" value="0" min="0" max="50">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Wrap the retirement simulation button in a container -->
            <div class="simulation-button-wrapper">
                <button id="runRetirementSimulation" class="simulation-button" onclick="runRetirementSimulation()">
                    Run Retirement Simulation
                </button>
            </div>
        </div>
        
        <div id="retirement-results" class="results-container" style="display: none; flex-direction: column;">
            <div class="section-header">
                <h2>Retirement Simulation Results</h2>
            </div>
            
            <div class="result-card primary-card">
                <div class="result-highlight" id="successRate">-</div>
                <p style="text-align: center;">
                    Probability of not running out of money
                    <span class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Based on thousands of simulations, this is the percentage of scenarios where your savings last throughout your retirement.</span>
                    </span>
                </p>
            </div>

            <!-- Add AI Analysis button after the primary result card -->
            <div class="ai-analysis-container">
                <button id="retirementAiAnalysisBtn" class="ai-analysis-button">
                    <svg width="24px" height="24px" viewBox="0 0 24 24" role="img" xmlns="http://www.w3.org/2000/svg" style="margin-right: 8px;"><title>OpenAI icon</title><path d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z" fill="currentColor"/></svg>
                    AI Analysis
                </button>
            </div>

            <div class="result-card">
                <h3>Portfolio Balance Over Time
                    <span class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Shows how your retirement portfolio value might change over time under different scenarios.</span>
                    </span>
                </h3>
                <div class="chart-label">Balance Projections</div>
                <div class="chart-container">
                    <canvas id="retirementBalanceChart"></canvas>
                </div>
            </div>
            
            <div class="result-card">
                <h3>Survival Probability by Age
                    <span class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Shows the probability that your portfolio will still have funds remaining at different ages.</span>
                    </span>
                </h3>
                <div class="chart-label">Likelihood of Having Money Left</div>
                <div class="chart-container">
                    <canvas id="survivalChart"></canvas>
                </div>
            </div>
            
            <div id="retirement-summary" class="result-card">
                <h3>Detailed Results
                    <span class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Key statistics from your retirement simulations.</span>
                    </span>
                </h3>
                
                <div class="summary-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div class="summary-item" style="border: 1px solid var(--neutral-light); padding: 16px; border-radius: var(--radius-sm); box-shadow: var(--shadow); background-color: white; text-align: center;">
                        <div class="summary-label">Median Balance at End</div>
                        <div class="summary-value" id="medianEndingBalance" style="font-size: 1.8rem; margin: 8px 0;">-</div>
                        <div class="summary-description" style="font-size: 0.85rem; color: var(--neutral);">Typical ending portfolio value</div>
                    </div>
                    <div class="summary-item" style="border: 1px solid var(--neutral-light); padding: 16px; border-radius: var(--radius-sm); box-shadow: var(--shadow); background-color: white; text-align: center;">
                        <div class="summary-label">Average Annual Return</div>
                        <div class="summary-value" id="retirementAvgReturn" style="font-size: 1.8rem; margin: 8px 0;">-</div>
                        <div class="summary-description" style="font-size: 0.85rem; color: var(--neutral);">During retirement years</div>
                    </div>
                    <div class="summary-item" style="border: 1px solid var(--neutral-light); padding: 16px; border-radius: var(--radius-sm); box-shadow: var(--shadow); background-color: white; text-align: center;">
                        <div class="summary-label">Total Withdrawals</div>
                        <div class="summary-value" id="totalWithdrawals" style="font-size: 1.8rem; margin: 8px 0;">-</div>
                        <div class="summary-description" style="font-size: 0.85rem; color: var(--neutral);">Median scenario (pre-tax)</div>
                    </div>
                    <div class="summary-item" style="border: 1px solid var(--neutral-light); padding: 16px; border-radius: var(--radius-sm); box-shadow: var(--shadow); background-color: white; text-align: center;">
                        <div class="summary-label">Worst Case Ending Age</div>
                        <div class="summary-value" id="worstCaseAge" style="font-size: 1.8rem; margin: 8px 0;">-</div>
                        <div class="summary-description" style="font-size: 0.85rem; color: var(--neutral);">When funds run out (10th percentile)</div>
                    </div>
                    <div class="summary-item" id="ssCoverageItem" style="border: 1px solid var(--neutral-light); padding: 16px; border-radius: var(--radius-sm); box-shadow: var(--shadow); background-color: white; text-align: center; display: none;">
                        <div class="summary-label">Income Sources Coverage</div>
                        <div class="summary-value" id="ssCoveragePercent" style="font-size: 1.8rem; margin: 8px 0;">-</div>
                        <div class="summary-description" style="font-size: 0.85rem; color: var(--neutral);">% of expenses covered by SS &amp; other income</div>
                    </div>
                </div>
            </div>

            <!-- Add this to the retirement-results section, after the last result-card div -->
            <div class="result-card">
                <h3>Simulation Results
                    <span class="tooltip-container">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">View detailed results from each simulation scenario.</span>
                    </span>
                </h3>
                
                <!-- Add this right before the table-container div -->
                <div class="filter-container">
                    <button class="filter-btn active" data-filter="all">All Simulations</button>
                    <button class="filter-btn success" data-filter="success">Successful</button>
                    <button class="filter-btn failure" data-filter="failure">Depleted</button>
                    <button class="filter-btn" data-filter="median">Median Simulation</button>
                </div>
                
                <div class="table-container">
                    <table class="simulations-table">
                        <thead>
                            <tr>
                                <th>Sim #</th> <!-- Changed from Scenario -->
                                <th>End Balance</th>
                                <th>Years Lasted</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="simulations-table-body">
                            <!-- Table rows will be added dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add this modal for displaying simulation details -->
            <div id="simulation-detail-modal" class="modal">
                <div class="modal-content simulation-detail-content">
                    <span class="close-modal" id="closeSimDetailModal">&times;</span>
                    <h2>Simulation <span id="simDetailId"></span> Details</h2>
                    
                    <div class="sim-detail-summary">
                        <div class="sim-detail-metric">
                            <div class="metric-label">Years to Goal</div>
                            <div class="metric-value" id="simDetailYears"></div>
                        </div>
                        <div class="sim-detail-metric">
                            <div class="metric-label">Final Balance</div>
                            <div class="metric-value" id="simDetailBalance"></div>
                        </div>
                        <div class="sim-detail-metric">
                            <div class="metric-label">Average Return</div>
                            <div class="metric-value" id="simDetailReturn"></div>
                        </div>
                    </div>
                    
                    <h3>Year-by-Year Data</h3>
                    <div class="yearly-data-container">
                        <table class="yearly-data-table">
                            <thead>
                                <tr>
                                    <th>Year</th>
                                    <th>Age</th>
                                    <th>Return</th>
                                    <th>Withdrawal</th>
                                    <th>Income</th>
                                    <th>Inflation</th>
                                </tr>
                            </thead>
                            <tbody id="yearlyDataTableBody">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="sim-detail-chart-container">
                        <canvas id="simDetailChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Add share button here -->
        <div class="share-container" id="shareContainer" style="display: none;">
            <button class="share-button" id="shareScenarioButton">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z" />
                </svg>
                Share This Scenario
            </button>
        </div>
    </div>
    
    </main>
    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeHelpModal">&times;</span>
            <h2>FIREcalc - Help Guide</h2>
            
            <div class="help-section">
                <h3>Tool Capabilities & Features</h3>
                <p>FIREcalc offers two powerful calculators to help you achieve financial independence and plan for early retirement:</p>
                
                <h4>Savings Calculator</h4>
                <ul>
                    <li><strong>Goal Projection:</strong> Estimate how long it might take to reach a specific savings target</li>
                    <li><strong>Key Milestones:</strong> See when you're projected to reach 25%, 50%, 75%, and 100% of your goal</li>
                    <li><strong>Range of Outcomes:</strong> View the distribution of possible timelines based on different market scenarios</li>
                    <li><strong>Growth Sources:</strong> Understand how much of your wealth comes from contributions vs. investment returns</li>
                    <li><strong>Simulation Summary:</strong> See optimistic, typical, and conservative estimates for reaching your goal</li>
                    <li><strong>Share Feature:</strong> Create shareable links to your specific scenarios</li>
                </ul>
                
                <h4>Retirement Calculator</h4>
                <ul>
                    <li><strong>Longevity Analysis:</strong> Project how long your retirement savings might last</li>
                    <li><strong>Success Rate:</strong> Calculate the probability of your money lasting through retirement</li>
                    <li><strong>Portfolio Simulation:</strong> See how your retirement account might change over time</li>
                    <li><strong>Withdrawal Strategy:</strong> Test different withdrawal amounts, with or without inflation adjustments</li>
                    <li><strong>Tax Impact:</strong> Account for taxes on withdrawals from retirement accounts</li>
                    <li><strong>Asset Allocation:</strong> Compare results with different stock/bond allocations</li>
                    <li><strong>Share Feature:</strong> Create shareable links to your specific scenarios</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>Simulation Approach</h3>
                <p>Our calculators use Monte Carlo simulation, a statistical technique that runs many scenarios with different market returns to provide a range of possible outcomes.</p>
                
                <h4>How It Works:</h4>
                <ol>
                    <li><strong>Multiple Scenarios:</strong> Each simulation runs 1,000 different market scenarios</li>
                    <li><strong>Random Sampling:</strong> Each year's returns are randomly selected from historical data</li>
                    <li><strong>Full Lifecycle:</strong> The tool simulates each year from your current age through retirement</li>
                    <li><strong>Percentile Results:</strong> Results show 10th percentile (optimistic), median (typical), and 90th percentile (conservative) outcomes</li>
                </ol>
                
                <h4>Key Assumptions:</h4>
                <ul>
                    <li>Inflation is modeled using Monte Carlo simulation with historical CPI data from 1975-2020, identical to how market returns are simulated</li>
                    <li>Investment returns are based on historical data (see below)</li>
                    <li>For the savings calculator, annual contributions are calculated as income minus expenses</li>
                    <li>Taxes are estimated based on the specified tax rate in retirement</li>
                    <li>All values are in today's dollars when adjusted for inflation</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>Historical Data Sources</h3>
                <p>Our simulations use historical market data from 1975 to 2020 for a realistic range of potential outcomes:</p>
                
                <ul>
                    <li><strong>Stock Returns:</strong> S&P 500 Total Return Index, including dividends (1975-2020)</li>
                    <li><strong>Bond Returns:</strong> Bloomberg US Aggregate Bond Index (1975-2020)</li>
                    <li><strong>Inflation Data:</strong> US Consumer Price Index (CPI) data (1975-2020)</li>
                </ul>
                
                <p>This period includes major events like:</p>
                <ul>
                    <li>Multiple recessions (1980s, 2001, 2008-2009)</li>
                    <li>Bull markets of the 1980s, 1990s, and 2010s</li>
                    <li>High inflation periods (late 1970s)</li>
                    <li>Low interest rate environments (2010s)</li>
                </ul>
                
                <p><strong>Important Note:</strong> Past performance does not guarantee future results. These simulations provide estimates based on historical data but cannot predict future market performance with certainty.</p>
            </div>
            
            <div class="help-section">
                <h3>FAQ</h3>
                
                <h4>What is FIRE?</h4>
                <p>FIRE stands for Financial Independence, Retire Early. It's a movement focused on extreme savings and investment to allow for early retirement. The core principle is to save and invest a large percentage of your income (often 50-70%) for a period of time, creating a portfolio that can sustain your living expenses indefinitely, typically through passive income or safe withdrawal strategies.</p>
                
                <h4>What is the 4% rule?</h4>
                <p>The 4% rule is a retirement withdrawal strategy that suggests you can withdraw 4% of your initial portfolio value annually (adjusted for inflation) with a high probability of not running out of money over a 30-year retirement. It originated from the Trinity Study and is a cornerstone of FIRE planning. Our retirement calculator allows you to test different withdrawal rates to find what works for your specific situation.</p>
                
                <h4>How do I know if I've reached my FIRE number?</h4>
                <p>Your FIRE number is typically calculated as 25 times your annual expenses (based on the 4% rule). For example, if you need $40,000 per year to live, your FIRE number would be $1,000,000. The savings calculator can help you project how long it might take to reach this target. Many FIRE practitioners also distinguish between "lean FIRE" (minimal expenses), "regular FIRE," and "fat FIRE" (more generous spending) depending on lifestyle goals.</p>
                
                <h4>How accurate are these projections?</h4>
                <p>The projections provide reasonable estimates based on historical market behavior from 1975-2020, but cannot account for unprecedented events or structural economic changes. We recommend using the results as a planning guideline rather than an exact prediction. For critical financial decisions, consider consulting with a financial advisor who understands FIRE principles.</p>
                
                <h4>Should I use the optimistic, median, or conservative estimate for planning?</h4>
                <p>Most FIRE practitioners recommend using the conservative (90th percentile) estimate for critical planning to build in a safety margin. This helps protect against sequence of returns risk, which is particularly important for early retirees who have a longer retirement horizon. The median estimate shows the most statistically likely outcome, but using it provides less protection against market downturns early in retirement.</p>
                
                <h4>How do I interpret the "Range of Outcomes" chart?</h4>
                <p>This chart shows both individual and cumulative distributions. The colored bars represent how many simulations reached the goal in exactly that year, while the green line shows the cumulative percentage of simulations that reached the goal by that year. This helps you understand both when you're most likely to reach your FIRE goal and the probability of reaching it within a certain timeframe.</p>
                
                <h4>What does the "Success Rate" in the Retirement calculator mean?</h4>
                <p>The success rate is the percentage of simulations where your money lasted throughout your entire expected retirement period. For FIRE planning, many aim for a 90-95% success rate due to the longer retirement period. A higher success rate provides more confidence that your portfolio will survive market downturns, but may require you to work longer to build a larger nest egg.</p>
                
                <h4>How are taxes handled in the Retirement calculator?</h4>
                <p>The Retirement calculator applies your specified tax rate to determine how much you need to withdraw pre-tax to achieve your desired after-tax withdrawal amount. For FIRE planning, tax optimization is crucial - consider strategies like Roth conversion ladders, tax-loss harvesting, and staying in lower tax brackets by managing your income carefully.</p>
                
                <h4>What if I want to include other income sources like rental properties or part-time work?</h4>
                <p>You can account for these by reducing your withdrawal amount by the expected income from these sources. For example, if you need $40,000 annually but expect $10,000 from a rental property, you would set your withdrawal amount to $30,000. Many FIRE practitioners use a combination of portfolio withdrawals and side income ("barista FIRE" or "coast FIRE") to reduce pressure on their investment portfolio.</p>
                
                <h4>How should I adjust my FIRE plan for inflation?</h4>
                <p>Both calculators use Monte Carlo simulation with historical inflation data, randomly sampling actual inflation rates for each year. In the Retirement calculator, enabling the "Adjust for Inflation" option ensures your withdrawals maintain purchasing power throughout your retirement. This is especially important for early retirees who may face 40+ years of inflation effects.</p>
                
                <h4>What asset allocation is best for FIRE?</h4>
                <p>There's no one-size-fits-all answer, but many FIRE practitioners maintain a relatively high stock allocation (70-80%) even in retirement due to the longer time horizon. Use the Stock Allocation slider to test different allocations and see how they affect your success rate and potential portfolio growth. Consider decreasing stock allocation slightly as you approach your FIRE date to reduce sequence of returns risk.</p>
            </div>
        </div>
    </div>
    
    <button id="helpButton" class="round-button" aria-label="Help">?</button>
    
    <!-- Toast notification -->
    <div class="toast" id="toast">Link copied to clipboard!</div>
    
    <!-- Success message for high retirement success rate -->
    <div id="success-message" class="success-message" style="display: none;">
        Congratulations! Your retirement plan looks very secure! üéâ
    </div>

    <!-- Add AI Analysis Modal -->
    <div id="aiAnalysisModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeAiAnalysisModal">&times;</span>
            <h2>AI Analysis</h2>
            
            <div class="ai-options-container">
                <div class="ai-option" id="exportDataOption">
                    <div class="ai-option-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="36" height="36">
                            <path d="M9.97.97a.75.75 0 011.06 0l3 3a.75.75 0 01-1.06 1.06l-1.72-1.72v3.44h-1.5V3.31L8.03 5.03a.75.75 0 01-1.06-1.06l3-3zM9.75 6.75v6a.75.75 0 001.5 0v-6h3a3 3 0 013 3v7.5a3 3 0 01-3 3h-7.5a3 3 0 01-3-3v-7.5a3 3 0 013-3h3z" />
                        </svg>
                    </div>
                    <h3>Export Data</h3>
                    <p>Save a screenshot of your results and copy simulation data to clipboard</p>
                </div>
                
                <div class="ai-option" id="aiAnalysisOption">
                    <div class="ai-option-icon">
                        <svg width="36px" height="36px" viewBox="0 0 24 24" role="img" xmlns="http://www.w3.org/2000/svg"><title>OpenAI icon</title><path d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z" fill="currentColor"/></svg>
                    </div>
                    <h3>AI Insight</h3>
                    <p>Send your simulation results to OpenAI for personalized analysis and recommendations</p>
                </div>
            </div>
            
            <!-- API Key Input Section (Initially Hidden) -->
            <!--
            <div id="apiKeySection" style="display: none;">
                <h3>Enter your OpenAI API Key</h3>
                <p>Your API key is used locally and never stored on our servers.</p>
                <div class="api-key-input-container">
                    <input type="password" id="openaiApiKey" placeholder="sk-..." class="api-key-input">
                    <button id="submitApiKey" class="api-key-submit">Analyze</button>
                </div>
                <div class="api-key-help">
                    <p>Don't have an API key? <a href="https://platform.openai.com/account/api-keys" target="_blank">Get one from OpenAI</a></p>
                </div>
            </div>
            -->
            
            <!-- AI Analysis Results Section (Initially Hidden) -->
            <div id="aiAnalysisResults" style="display: none;">
                <h3>AI Analysis Results</h3>
                <div id="aiAnalysisContent" class="ai-analysis-content">
                    <div class="ai-loading">
                        <div class="spinner"></div>
                        <p>Analyzing your financial scenario...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- CSS for AI Analysis Feature -->

    <!-- CSS for AI Analysis Feature moved to styles.css -->

    <!-- Duplicate script blocks removed ‚Äî all handlers in consolidated DOMContentLoaded -->
    <script src="tax-engine.js"></script>
    <script src="app.js"></script>
</body>
</html>
